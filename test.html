<!DOCTYPE html>
<html>
<head>
<title>ボールを動かす (戻るアニメーションなし)</title>
<style>
  body { margin: 0; overflow: hidden; background-color: #f0f0f0; }
  #container { position: relative; width: 100vw; height: 100vh; }
  .ball {
    position: absolute;
    width: 40px;
    height: 40px;
    background-color: lightblue;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 10px;
  }
  #box {
    position: absolute;
    width: 80px;
    height: 60px;
    background-color: lightcoral;
    border: 2px solid red;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 16px;
  }
</style>
</head>
<body>

<div id="container">
  <div id="ball1" class="ball">ボール1</div>
  <div id="ball2" class="ball">ボール2</div>
  <div id="ball3" class="ball">ボール3</div>
  <div id="ball4" class="ball">ボール4</div>
  <div id="box">ボックス</div>
</div>

<script>
  const container = document.getElementById('container');
  const balls = [
    { element: document.getElementById('ball1'), startX: 0, startY: 0 },
    { element: document.getElementById('ball2'), startX: 0, startY: 0 },
    { element: document.getElementById('ball3'), startX: 0, startY: 0 },
    { element: document.getElementById('ball4'), startX: 0, startY: 0 },
  ];
  const box = document.getElementById('box');

  const boxMargin = 20;
  const boxRect = {
    left: container.offsetWidth - box.offsetWidth - boxMargin,
    top: container.offsetHeight - box.offsetHeight - boxMargin,
    right: container.offsetWidth - boxMargin,
    bottom: container.offsetHeight - boxMargin,
  };
  box.style.left = `${boxRect.left}px`;
  box.style.top = `${boxRect.top}px`;

  const centerX = container.offsetWidth / 2;
  const centerY = container.offsetHeight / 2;
  const offset = 30;

  balls[0].startX = centerX - offset;
  balls[0].startY = centerY - offset;
  balls[1].startX = centerX + offset;
  balls[1].startY = centerY - offset;
  balls[2].startX = centerX - offset;
  balls[2].startY = centerY + offset;
  balls[3].startX = centerX + offset;
  balls[3].startY = centerY + offset;

  balls.forEach(ballInfo => {
    const ballElement = ballInfo.element;
    ballElement.style.left = `${ballInfo.startX - ballElement.offsetWidth / 2}px`;
    ballElement.style.top = `${ballInfo.startY - ballElement.offsetHeight / 2}px`;
    let animationInterval = null;
    let isMoving = false;

    ballElement.addEventListener('click', () => {
      if (isMoving) return;
      isMoving = true;

      if (animationInterval) {
        clearInterval(animationInterval);
        animationInterval = null;
      }

      const targetX = boxRect.left + box.offsetWidth / 2 - ballElement.offsetWidth / 2;
      const targetY = boxRect.top + box.offsetHeight / 2 - ballElement.offsetHeight / 2;
      const startX = parseFloat(ballElement.style.left);
      const startY = parseFloat(ballElement.style.top);
      const duration = 1000;
      let startTime;

      function animateToBox(currentTime) {
        if (!startTime) {
          startTime = currentTime;
        }
        const elapsed = currentTime - startTime;
        const progress = Math.min(1, elapsed / duration);
        const newX = startX + (targetX - startX) * progress;
        const newY = startY + (targetY - startY) * progress;

        ballElement.style.left = `${newX}px`;
        ballElement.style.top = `${newY}px`;

        // ボックスに入ったかどうかの判定
        const ballRect = ballElement.getBoundingClientRect();
        if (
          ballRect.left >= boxRect.left &&
          ballRect.right <= boxRect.right &&
          ballRect.top >= boxRect.top &&
          ballRect.bottom <= boxRect.bottom
        ) {
          isMoving = false;
          // ボックスに入ったら元の位置に瞬時に戻す
          ballElement.style.left = `${ballInfo.startX - ballElement.offsetWidth / 2}px`;
          ballElement.style.top = `${ballInfo.startY - ballElement.offsetHeight / 2}px`;
          return;
        }

        if (progress < 1) {
          requestAnimationFrame(animateToBox);
        } else {
          isMoving = false; // アニメーションが完了してもボックスに入らなかった場合は移動フラグをリセット
          animationInterval = null;
        }
      }

      requestAnimationFrame(animateToBox);
    });
  });
</script>

</body>
</html>